!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},n={},r={},i={}.hasOwnProperty,o=/^\.\.?(\/|$)/,a=function(e,t){for(var n,r=[],i=(o.test(t)?e+"/"+t:t).split("/"),a=0,s=i.length;a<s;a++)n=i[a],".."===n?r.pop():"."!==n&&""!==n&&r.push(n);return r.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},u=function(t){return function(n){var r=a(s(t),n);return e.require(r,t)}},c=function(e,t){var r=v&&v.createHot(e),i={id:e,exports:{},hot:r};return n[e]=i,t(i.exports,u(e),i),i.exports},h=function(e){return r[e]?h(r[e]):e},d=function(e,t){return h(a(s(e),t))},l=function(e,r){null==r&&(r="/");var o=h(e);if(i.call(n,o))return n[o].exports;if(i.call(t,o))return c(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};l.alias=function(e,t){r[t]=e};var y=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/,p=function(e){if(y.test(e)){var t=e.replace(y,"");i.call(r,t)&&r[t].replace(y,"")!==t+"/index"||(r[t]=e)}if(f.test(e)){var n=e.replace(f,"");i.call(r,n)||(r[n]=e)}};l.register=l.define=function(e,r){if(e&&"object"==typeof e)for(var o in e)i.call(e,o)&&l.register(o,e[o]);else t[e]=r,delete n[e],p(e)},l.list=function(){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e};var v=e._hmr&&new e._hmr(d,l,t,n);l._cache=n,l.hmr=v&&v.wrap,l.brunch=!0,e.require=l}}(),function(){function e(){var e=200,n=50;g.push(new h(e,n,0,0,0,0,(!0),[1]));for(var r=1;r<u.numOfNodes;r++){e+=u.nominalStringLength;var i=[r-1];r<u.numOfNodes-1&&i.push(r+1),g.push(new h(e,n,0,0,0,0,(!1),i))}var o=s.getNode(g.length-1,g);o.fixed=!0,o.position.x=260,o.position.y=300;var a=new h(220,50,0,0,0,0,(!0),[1]);g.push(a);var c=s.getNode(1,g);c.connectedNodes.push(a.id),importScripts("calc.js"),Module.onRuntimeInitialized=function(){t(),f=!0}}function t(){var e=function(e,t){return t?g.map(function(t){return t[e]}).map(function(e){return e[t]}):g.map(function(t){return t[e]})},t=g.map(function(e){var t=new Int32Array(e.connectedNodes),n=Module._malloc(t.length*t.BYTES_PER_ELEMENT);return Module.HEAP32.set(t,n>>2),{buf:n,len:e.connectedNodes.length}});ccall("setConfig",null,[],[]),y("setFloats",null,["array","array","array","array","array","array","array","array","number"],[e("position","x"),e("position","y"),e("velocity","x"),e("velocity","y"),e("force","x"),e("force","y")],{heapIn:"HEAPF32"}),y("setInts",null,["number","array","array","array"],[g.length,e("id"),e("fixed").map(function(e){return e?1:0}),e("grabbed").map(function(e){return e?1:0}),t.map(function(e){return e.buf}),t.map(function(e){return e.len})],{heapIn:"HEAP32"})}function n(){var e=g;g.forEach(function(t){t.connectedNodes.forEach(function(n){var r=s.getNode(n,g);r.connectedNodes.indexOf(t.id)<0&&(e=e.map(function(e){return e.id===n&&e.connectedNodes.push(t.id),e}))})}),g=e}function r(){if(p)f?setTimeout(a,0):setTimeout(r,100);else{x=self.performance.now(),setTimeout(o,0)}}function i(e){var t=0,n=0,r=0,i=0;e.connectedNodes.forEach(function(o){var a=s.getNode(o,g);if(a){var c=s.getLength(a,e);if(c>u.nominalStringLength){var h=c-u.nominalStringLength,d=s.getAngleFromHorizontal(e,a);t+=Math.sin(d)*h*u.springConstant,n+=Math.cos(d)*h*u.springConstant}r+=u.internalViscousFrictionConstant*(e.velocity.x-a.velocity.x),i+=u.internalViscousFrictionConstant*(e.velocity.y-a.velocity.y)}});var o=9.8*u.ropeWeightPerNode,a=0*u.ropeWeightPerNode,h=e.velocity.y*u.viscousConstant,d=e.velocity.x*u.viscousConstant;return e.force.y=o+t-h-i,e.force.x=a+n-d-r,new c(e.force.x/u.ropeWeightPerNode,e.force.y/u.ropeWeightPerNode)}function o(){for(var e=0,n=0,r=0,s=0;s<100;s++){var c=self.performance.now(),h=c-x,d=h/1e3,l=h*u.simulationSpeed;l>u.maxStep?(elapsedTime=u.maxStep/1e3,console.warn("Max step exceeded, simulation speed may not be correct.")):elapsedTime=l/1e3;var y=elapsedTime/d;isNaN(y)||(e+=1,n+=y,r+=l),x=c;for(var f=[],A=0;A<g.length;A++){var b=g[A].copy();b.fixed||b.grabbed||(b.velocity.x=b.velocity.x+b.force.x/u.ropeWeightPerNode*elapsedTime/2,b.velocity.y=b.velocity.y+b.force.y/u.ropeWeightPerNode*elapsedTime/2,b.position.y=b.position.y+b.velocity.y*elapsedTime,b.position.x=b.position.x+b.velocity.x*elapsedTime,dv=i(b).multiply(elapsedTime/2),b.velocity.x=b.velocity.x+dv.x,b.velocity.y=b.velocity.y+dv.y),f.push(b)}g=f}m=n/e,z=r/e,v&&(p?(t(),setTimeout(a,0)):setTimeout(o,0))}function a(){ccall("simulate",null,[],[]);var e=y("getIDs","array",[],[],{heapOut:"HEAP32",returnArraySize:g.length}),t=y("getPositionXs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),n=y("getPositionYs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),r=y("getVelocityXs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),i=y("getVelocityXs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),s=y("getForceXs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),u=y("getForceYs","array",[],[],{heapOut:"HEAPF32",returnArraySize:g.length}),c=y("getFixeds","array",[],[],{heapOut:"HEAP32",returnArraySize:g.length}),d=(y("getGrabbeds","array",[],[],{heapOut:"HEAP32",returnArraySize:g.length}),y("getConnectedNodesSize","array",[],[],{heapOut:"HEAP32",returnArraySize:g.length})),l=[],f=0;d.forEach(function(e){l.push(y("getConnectedNodes","array",["number"],[f],{heapOut:"HEAP32",returnArraySize:e})),f++}),g=[];for(var x=0;x<e.length;x++)g.push(new h(t[x],n[x],r[x],i[x],s[x],u[x],1===c[x],l[x],e[x]));z=ccall("getElapsedTimeAverage","number",[],[]),v&&(p?setTimeout(a,0):setTimeout(o,0))}"undefined"==typeof window?this:window;require.register("js/shared/config.js",function(e,t,n){"use strict";var r=10,i=40,o=10,a=25,s=8,u=2e-5,c=4,h=50,d=150,l=0,y=1,f=o/r*y;n.exports={metre:r,numOfNodes:i,nominalStringLength:o,springConstant:a,internalViscousFrictionConstant:s,viscousConstant:u,simulationSpeed:c,maxStep:h,dangerForceMax:d,dangerForceMin:l,ropeWeightPerMetre:y,ropeWeightPerNode:f}}),require.register("js/shared/constants.js",function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.ControlsEnum=Object.freeze({pan:"pan",grab:"grab",anchor:"anchor",erase:"erase",rope:"rope",pause:"pause"}),i=e.ActionsEnum=Object.freeze({init:"init",run:"run",pause:"pause",send:"send",load:"load",move:"move",nomove:"nomove",addanchor:"addanchor",addnodes:"addnodes",deletenode:"deletenode",usewasm:"usewasm"});n.exports={ControlsEnum:r,ActionsEnum:i}}),require.register("js/shared/helper.js",function(e,t,n){"use strict";function r(e,t){return t.find(function(t){return t.id===e})}function i(e,t){var n=Math.abs(e.position.x-t.position.x),r=Math.abs(e.position.y-t.position.y);return Math.sqrt(n*n+r*r)}function o(e,t){return{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2}}function a(e,t){return Math.atan2(t.position.y-e.position.y,t.position.x-e.position.x)}function s(e,t){var n=i(e,t),r=n-u.nominalStringLength,o=a(e,t),s=Math.sin(o)*r*u.springConstant,c=Math.cos(o)*r*u.springConstant,h=Math.sqrt(s*s+(c+c));return{total:h,x:c,y:s}}var u=t("js/shared/config");n.exports={getAngleFromHorizontal:a,getForce:s,getLength:i,getMidpoint:o,getNode:r}}),require.register("js/shared/node.js",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){return s+=1}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=t("js/shared/vector").Vector,s=-1,u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],l=arguments[8];r(this,e),this.id=l||0===l?l:i(),this.position=new a(t,n),this.velocity=new a(o,s),this.force=new a(u,c),this.fixed=h,this.connectedNodes=d,this.grabbed=!1}return o(e,[{key:"getObject",value:function(){return{id:this.id,position:this.position,velocity:this.velocity,force:this.force,fixed:this.fixed,grabbed:this.grabbed,connectedNodes:this.connectedNodes}}},{key:"loadObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.id=e.id||this.id,this.position=e.position||this.position,this.velocity=e.velocity||this.velocity,this.force=e.force||this.force,this.fixed=e.fixed||this.fixed,this.connectedNodes=e.connectedNodes||this.connectedNodes,this.grabbed=!1}},{key:"copy",value:function(){return new e(this.position.x,this.position.y,this.velocity.x,this.velocity.y,this.force.x,this.force.y,this.fixed,this.connectedNodes,this.id)}}]),e}();n.exports={Node:u}}),require.register("js/shared/vector.js",function(e,t,n){"use strict";function r(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}r.prototype={load:function(e){return new r(e.x||0,e.y||0,e.z||0)},negative:function(){return new r((-this.x),(-this.y),(-this.z))},add:function(e){return e instanceof r?new r(this.x+e.x,this.y+e.y,this.z+e.z):new r(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof r?new r(this.x-e.x,this.y-e.y,this.z-e.z):new r(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof r?new r(this.x*e.x,this.y*e.y,this.z*e.z):new r(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof r?new r(this.x/e.x,this.y/e.y,this.z/e.z):new r(this.x/e,this.y/e,this.z/e)},modulus:function(e){return e instanceof r?new r(this.x%e.x,this.y%e.y,this.z%e.z):new r(this.x%e,this.y%e,this.z%e)},positive:function(){return new r(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new r(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new r(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},r.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},r.add=function(e,t,n){return n=n?n:new r,t instanceof r?(n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z):(n.x=e.x+t,n.y=e.y+t,n.z=e.z+t),n},r.subtract=function(e,t,n){return n=n?n:new r,t instanceof r?(n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z):(n.x=e.x-t,n.y=e.y-t,n.z=e.z-t),n},r.multiply=function(e,t,n){return n=n?n:new r,t instanceof r?(n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z):(n.x=e.x*t,n.y=e.y*t,n.z=e.z*t),n},r.divide=function(e,t,n){return t instanceof r?(n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z):(n.x=e.x/t,n.y=e.y/t,n.z=e.z/t),n},r.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},r.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},r.fromAngles=function(e,t){return new r(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},r.randomDirection=function(){return r.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},r.min=function(e,t){return new r(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},r.max=function(e,t){return new r(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},r.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},r.fromArray=function(e){return new r(e[0],e[1],e[2])},r.angleBetween=function(e,t){return e.angleTo(t)},n.exports={Vector:r}}),require.register("js/shared/wasm-arrays.js",function(e,t,n){"use strict";var r=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.heapIn,a=void 0===o?"HEAPF32":o,s=i.heapOut,u=void 0===s?"HEAPF32":s,c=i.returnArraySize,h=void 0===c?1:c,d={};d.HEAP8=Int8Array,d.HEAPU8=Uint8Array,d.HEAP16=Int16Array,d.HEAPU16=Uint16Array,d.HEAP32=Int32Array,d.HEAPU32=Uint32Array,d.HEAPF32=Float32Array,d.HEAPF64=Float64Array;var l=void 0,y=void 0;n=n||[];var f="array"==t?"number":t,p=[],v=[],g=[];try{if(r)for(var x=0;x<r.length;x++)if("array"==n[x]||Array.isArray(r[x])){var m=new d[a](r[x]),z=Module._malloc(m.length*m.BYTES_PER_ELEMENT);switch(a){case"HEAP8":case"HEAPU8":Module[a].set(m,z);break;case"HEAP16":case"HEAPU16":Module[a].set(m,z>>1);break;case"HEAP32":case"HEAPU32":case"HEAPF32":Module[a].set(m,z>>2);break;case"HEAPF64":Module[a].set(m,z>>3)}g.push(z),p.push(z),p.push(r[x].length),v.push("number"),v.push("number")}else p.push(r[x]),v.push(void 0==n[x]?"number":n[x]);l=Module.ccall(e,f,v,p)}catch(A){y=A}finally{}if(y)throw y;if("array"==t){for(var b=[],w=0;w<h;w++)b.push(Module[u][l/d[u].BYTES_PER_ELEMENT+w]);return b}return l},i=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i.heapIn,a=void 0===o?"HEAPF32":o,s=i.heapOut,u=void 0===s?"HEAPF32":s,c=i.returnArraySize,h=void 0===c?1:c;return function(i){return r(e,t,n,i,{heapIn:a,heapOut:u,returnArraySize:h})}};"undefined"==typeof window&&(e.ccallArrays=r)&(e.cwrapArrays=i)});var s=require("js/shared/helper"),u=require("js/shared/config"),c=require("js/shared/vector").Vector,h=require("js/shared/node").Node,d=require("js/shared/constants").ActionsEnum,l=require("js/shared/wasm-arrays"),y=l.ccallArrays,f=(l.cwrapArrays,!1),p=!0,v=!0,g=[],x=new Date,m=0,z=0;onmessage=function(t){switch(t.data.type){case d.init:e();break;case d.run:v=!0,r();break;case d.pause:v=!1;break;case d.send:postMessage({nodes:g,trueSimulationSpeed:m,elapsedTimeSumAverage:z});break;case d.load:g=JSON.parse(atob(t.data.nodes));break;case d.move:var i=s.getNode(t.data.selectedNode.id,g);i.position=(new c).load(t.data.mousePosition),i.velocity=new c,i.force=new c,i.grabbed=!0;break;case d.nomove:var i=s.getNode(t.data.node.id,g);i.grabbed=!1;break;case d.addanchor:var o=t.data.mousePosition;g.push(new h(o.x,o.y,0,0,0,0,(!0),[]));break;case d.deletenode:var i=t.data.node;g=g.filter(function(e){return e.id!==i.id}).map(function(e){return e.connectedNodes=e.connectedNodes.filter(function(e){return e!==i.id}),e});break;case d.addnodes:var a=t.data.nodes;g=g.concat(a),n();break;case d.usewasm:p=t.data.useWasm}},require.register("___globals___",function(e,t,n){})}(),require("___globals___");